<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Project 1</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
  </head>
  <body>
    <p> <a href=""></a> </p>

    <p>
      <script>

      Promise.all([
        d3.csv("data/player_data.csv"),
        d3.csv("data/Seasons_Stats.csv")
      ]).then(function(data){
          player_data = data[0].filter(d => d['year_end'] === "2018");
          // console.log(player_data);

          season_stats = data[1].filter(d => d['Year'] === "2017" && d['G'] > 50);
          // console.log(season_stats);

          let blk_stl_array = [];
          let blk_array = [];
          let block_total = 0;
          let steal_total = 0;

          season_stats.forEach(function(d,i){
            d['BLK'] = Number(d['BLK']);
            d['STL'] = Number(d['STL']);
            d['G'] = Number(d['G']);
            block_total += d['BLK'];
            steal_total += d['STL'];
          });

          console.log(block_total)
          console.log(steal_total)
          let maxBlock = d3.max(season_stats, d => d['BLK']);
          console.log(maxBlock)
          let stl_blk_ratio = steal_total/block_total;
          let blk_stl_ratio = block_total/steal_total;

          season_stats.forEach(function(d,i){
            d['steals_norm'] = d['STL'] * blk_stl_ratio;
          });

          season_stats.forEach(function(d, i) {
            BSPG = (d['steals_norm'] + d['BLK'])/ d['G'];
            if(BSPG > 1.609){
              blk_stl_array.push({"name": d['Player'], "value": BSPG, "blocks": d['BLK'], "steals": d['steals_norm']})
            };
          });

          blk_stl_array.sort(function(a, b) {
            return b.value - a.value;
          });
          console.log(blk_stl_array)
        });
      </script>
    </p>
  </body>
</html>
