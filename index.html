<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Project 1</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
  </head>
  <body>

    <svg id = "bar_chart" height = "850" width = "700" >

    </svg>

    <svg id = "height_chart">

    </svg>

    <svg id = "silhouette">

    </svg>
    <p>
      <script>

      Promise.all([
        d3.csv("data/player_data.csv"),
        d3.csv("data/Seasons_Stats.csv")
      ]).then(function(data){
          player_data = data[0].filter(d => d['year_end'] === "2018");
          // console.log(player_data);

          season_stats = data[1].filter(d => d['Year'] === "2017" && d['G'] > 50);
          // console.log(season_stats);

          let blk_stl_array = [];
          let blk_array = [];
          let block_total = 0;
          let steal_total = 0;

          season_stats.forEach(function(d,i){
            d['BLK'] = Number(d['BLK']);
            d['STL'] = Number(d['STL']);
            d['G'] = Number(d['G']);
            block_total += d['BLK'];
            steal_total += d['STL'];
          });


          let maxBlock = d3.max(season_stats, d => d['BLK']);
          let stl_blk_ratio = steal_total/block_total;
          let blk_stl_ratio = block_total/steal_total;

          season_stats.forEach(function(d,i){
            d['steals_norm'] = d['STL'] * blk_stl_ratio;
          });

          season_stats.forEach(function(d, i) {
            BSPG = (d['steals_norm'] + d['BLK'])/ d['G'];
            BPG = d['BLK']/ d['G'];
            SPG = d['steals_norm']/ d['G'];
            if(BSPG > 1.07){
              blk_stl_array.push({"name": d['Player'], "value": BSPG, "blocks": d['BLK'], "steals": d['steals_norm'], "BPG": BPG, "SPG": SPG})
            };
          });

          blk_stl_array.sort(function(a, b) {
            return b.value - a.value;
          });


          let bar_chart = d3.select("svg#bar_chart");
          let chart = bar_chart.append("g").attr("transform", "translate(130,63)");

          let score_scale = d3.scaleLinear().domain([0, blk_stl_array[0]["value"] + .5]).range([0,380]);
          let player_scale = d3.scaleLinear().domain([20, 1]).range([800, 0]);

          var x_axis = d3.axisBottom(score_scale).ticks(5, d3.format("f"))
          var y_axis = d3.axisLeft(player_scale).ticks(20);

          x_scale = bar_chart.append("g")
              .attr("transform","translate(130,0)")
              .call(x_axis);

          y_scale = bar_chart.append("g")
              .attr("transform","translate(130,20)")
              .call(y_axis);

          blk_stl_array.forEach(function(d, i){
            chart.append("rect")
                .attr("height", 15)
                .attr("width", score_scale(d["BPG"]))
                .attr("y", player_scale(i))
                .style("fill", "rgb(244, 101, 65)")
                .attr("stroke", "black")
                .attr("stroke-width", "1");
          });

          blk_stl_array.forEach(function(d, i){
            chart.append("rect")
                .attr("height", 15)
                .attr("width", score_scale(d["SPG"]))
                .attr("x", score_scale(d["BPG"]))
                .attr("y", player_scale(i))
                .style("fill", "rgb(66, 134, 244)")
                .attr("stroke", "black")
                .attr("stroke-width", "1");
            bar_chart.append("text")
                .attr("text-anchor", "middle")
                // .attr("transform", "translate(-50,210)rotate(-90)")
                .attr("y", player_scale(i)+73)
                .attr("x", 58)
                .attr("font-family","Palatino")
                .attr("font-size", "10px")
                .text(d["name"]);
          });
          bar_chart.append("text")
              .attr("text-anchor", "middle")
              // .attr("transform", "translate(-50,210)rotate(-90)")
              .attr("y", 12)
              .attr("x", 58)
              .attr("font-family","Palatino")
              .attr("font-size", "14px")
              .attr("font-weight", "bold")
              .text("Player Name");

          legend = bar_chart.append("g").attr("transform", "translate(530,60)");

          legend.append("rect")
              .attr("height", 100)
              .attr("width", 160)
              .attr("stroke", "black")
              .style("fill", "transparent");

          legend.append("rect")
              .attr("height", 15)
              .attr("width", 15)
              .attr("stroke", "black")
              .attr("x", 10)
              .attr("y", 30)
              .style("fill", "rgb(244, 101, 65)");

          legend.append("rect")
              .attr("height", 15)
              .attr("width", 15)
              .attr("stroke", "black")
              .attr("x", 10)
              .attr("y", 60)
              .style("fill", "rgb(66, 134, 244)");

          legend.append("text")
              .attr("text-anchor", "middle")
              // .attr("transform", "translate(-50,210)rotate(-90)")
              .attr("y", 40)
              .attr("x", 65)
              .attr("font-family","Palatino")
              .attr("font-size", "10px")
              .text("Blocks Per Game");

          legend.append("text")
              .attr("text-anchor", "middle")
              // .attr("transform", "translate(-50,210)rotate(-90)")
              .attr("y", 70)
              .attr("x", 91)
              .attr("font-family","Palatino")
              .attr("font-size", "10px")
              .text("Normalized Steals Per Game");

          legend.append("text")
              .attr("text-anchor", "middle")
              // .attr("transform", "translate(-50,210)rotate(-90)")
              .attr("y", 15)
              .attr("x", 78)
              .attr("font-family","Palatino")
              .attr("font-size", "14px")
              .attr("font-weight", "bold")
              .text("Legend");



          console.log(blk_stl_array)
        });
      </script>
    </p>
  </body>
</html>
